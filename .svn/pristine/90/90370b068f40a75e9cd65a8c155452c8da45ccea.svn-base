/**
 * SKIMP-FR-004.js
 * @ 간편인증
 * 2021.05.21
 */

var bioCertRstCd = "";
var pageInit = function(){

	//생체인증 가능 여부 체크
	fingerCheck();

	pageEvent();
};

var pageEvent = function(){

	//생체인증
	$(document).on('click', '#btnBio', function(){
		if(bioCertRstCd == "402"){
			MPopup.alert("디바에스에 등록된 생체인증 정보가 없습니다.");
		}else{
			bioCert.auth((status, result) => {
				console.log(status);
				if(status == "SUCCESS" && result.result == "SUCCESS"){
					MData.storage('lastLoginType', 'BIO');
					MData.storage('BioLoginData', 'Y');
					Login();
				}else{
					MPopup.alert({
						message : "생체 인증 로그인에 실패했습니다."
					});
				}
			});
		}
	});

	//패턴인증
	$(document).on('click', '#btnPattern', function(){
		ptCert.lock((status, result) => {
			console.log(status);
			console.log(result);
			if(result.message == "SUCCESS"){
				M.pop.alert('result : ' + JSON.stringify(result));
				MData.storage('lastLoginType', 'PATTERN');
				MData.storage('PatternLoginData', 'Y');
				Login();
			}else{
				MPopup.alert({
					message : "패턴이 틀렸습니다."
				});
			}
		});
	});

	//pin인증
	$(document).on('click', '#btnPin', function(){
		pinCert.register((status, result) => {
			console.log(status);

			if(result.message == "SUCCESS"){
				MData.storage('lastLoginType', 'PIN');
				MData.storage('PinLoginData', 'Y');
				Login();
			}else{
				MPopup.alert({
					message : "PIN 번호가 틀렸습니다."
				});
			}
		});
	});

	//건너뛰기 버튼
	$(document).on('click', '#btnNext', function(){
		Login();
	});
};


var Login = function(){
	//최초로그인 여부 저장
	MData.storage('firstLogin') == "N" ? "" : MData.storage('firstLogin', 'N');

	MPage.html({
		url : "SKIMP-FR-007.html",
		action : "CLEAR_TOP",
	})
}


var fingerCheck = function(){
	bioCert.check((status, result) => {
		console.log(status);
		if(status == "SUCCESS"){
			if(result.result != "SUCCESS"){
				bioCertRstCd = result.result_code;
			}
			$('#btnBio').removeClass('none');
		}else{
			$('#btnBio').addClass('none');
		}
	});
}


var MStatus = {
		onReady : function(){
			pageInit();
		},

//		onBack : function(){
//
//		},

		onRestore : function(){
			//현재화면에서 생체정보 등록후 다시 돌아왔을경우 체크
			fingerCheck();
		},

		onHide : function(){

		},

		onDestroy : function(){

		},

		onPause : function(){

		},

		onResume : function(){

		}
}