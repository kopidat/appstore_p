//
//  AppDelegate.m
//

#import "AppDelegate.h"
#import "PushReceiver.h"
#import <MPush/PushManager.h>
#import <MPush/AppDelegate+PushManager.h>

@interface AppDelegate ()

@property (strong, nonatomic) PPNavigationController *navigationController;

@end

@implementation AppDelegate

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    // Override point for customization after application launch.
    
    window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];
    navigationController = [MAppDelegate initialViewControllerWithLaunchOptions:launchOptions];
    
    [window setBackgroundColor:[UIColor blackColor]];
    [window setRootViewController:navigationController];
    [window makeKeyAndVisible];
    
    [[PushManager defaultManager] application:application didFinishLaunchingWithOptions:launchOptions];
    [[PushManager defaultManager] initilaizeWithDelegate:[[PushReceiver alloc] init]];
    
    return YES;
}

- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary<UIApplicationOpenURLOptionsKey,id> *)options {
    NSMutableString *url_mutable = [[NSMutableString alloc] initWithString:url.absoluteString];
    NSRange range = [url_mutable rangeOfString:@"="];
    
    if (range.location != NSNotFound) {
        [url_mutable deleteCharactersInRange:NSMakeRange(0, range.location + 1)];
        
        NSNotificationCenter *notificationCenter = [NSNotificationCenter defaultCenter];
        [notificationCenter postNotificationName:@"get_message" object:nil userInfo:@{@"MDS_STATUS":url_mutable}];
    }
    
    return true;
}

@synthesize window, navigationController;

@end
